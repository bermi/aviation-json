#!/usr/bin/env node

"use strict";

var program = require("commander");
var version = require("../package.json").version;

var scrapeJs = require("./scrape.js");
var reduceAirlines = scrapeJs.reduceAirlines;
var reduceAirports = scrapeJs.reduceAirports;

var airlineDestinations = require("../tmp/airline_destinations.json");
var airportsRaw = require("../tmp/airports.json");

var fs = require("fs");
var destinations, airports;

program
  .version(version)
  .description("This package uses aviation-scraper to get the information and prepare it for a database usage")
  .option("-d, --destinations", "generates the destinations with only the primary keys.")
  .option("-a, --airports", "generates the airports file.")
  .parse(process.argv);

if (!program.destinations && !program.airports) {
  program.help();
}

if (program.destinations){
  destinations = reduceAirlines(airlineDestinations);
  saveFile("./data/airline_destinations.json", destinations, logDone);
}

if (program.airports) {
  airports = reduceAirports(airportsRaw);
  console.log(airports);

  saveFile("./data/airports.json", airports, logDone);
}

function logDone() {
  console.log("file Saved");
}

function saveFile(dir, data, callback) {
  fs.writeFile(dir, JSON.stringify(data,null, 2), function(err) {
    if (err) {throw err;}
    callback();
  });
  
}
